#!/bin/bash

# Set defaults
default_args() {
    declare -g -A ARGS
    ARGS[CHANGER]=/dev/changer
    ARGS[COMMAND]=
    ARGS[SOURCE]=
    ARGS[TARGET]=
    ARGS[EMPTY_SLOT]=
    ARGS[RUN]=0
    ARGS[QUIET]=0
    ARGS[REV_SOURCE]=0
    ARGS[REV_TARGET]=0
}

# Parse command arguments
parse_args() {
    declare -a NON_FLAGS
    # Parse flag arguments
    while [[ $# -gt 0 ]]; do
        ARG="$1"
        case $ARG in
        -f)
            ARGS[CHANGER]="$2"
            shift; shift ;;
        --run)
            ARGS[RUN]=1
            shift ;;
        --quiet|-q)
            ARGS[QUIET]=1
            shift ;;
        --use-empty|-e)
            ARGS[EMPTY_SLOT]="$2"
            shift; shift ;;
        --reverse)
            ARGS[REV_SOURCE]=1
            ARGS[REV_TARGET]=1
            shift ;;
        --reverse-source)
            ARGS[REV_SOURCE]=1
            shift ;;
        --reverse-target)
            ARGS[REV_TARGET]=1
            shift ;;
        *)
            NON_FLAGS+=("$ARG")
            shift ;;
        esac
    done

    # Parse non-flag arguments
    ARGS[COMMAND]=${NON_FLAGS[0]}
    ARGS[SOURCE]=${NON_FLAGS[1]}
    ARGS[TARGET]=${NON_FLAGS[2]}
    # If additional arguments exists, error and exit
    if [[ ! -z ${NON_FLAGS[3]} ]]; then
       echo "ERROR: Unknown extra arguments: ${NON_FLAGS[@]:3}"
       exit 1
    fi
}

# Validate args
check_args() {
    #TODO
    echo "TODO"
}

###############################
## Convert a single integer range to list of integers
##  $1 -> An integer range (e.g. 3-8) or a simple integer (e.g. 5)
## Prints the expanded list of ingeters generated from the range, or just prints the simple integer passed
int_range2list() {
    #TODO
    echo "TODO"
}

# Convert a comma separated list of integers and ranges into a single list of integers
int_csl2list() {
    #TODO
    echo "TODO"
}


# Start
default_args
parse_args "$@"
check_args


